<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>On-Chain SetValues</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 0; padding-top: 120px; color: #000; }
    header { position: fixed; top: 0; width: 100%; z-index: 999; background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid #ccc; }
    #login { padding: 15px; text-align: center; }
    .painel { padding: 15px; display: none; }
    .azul { background-color: #3399ff !important; }
    .verde { background-color: #4D4D4D !important; color: #fff !important; }
    .amarelo { background-color: #A05200 !important; color: #fff !important; }
    .rosa { background-color: #C9A9FF !important; color: #000 !important; }
  </style>
</head>
<body>

<header>
  <div><strong>Entre 2.000 criptos, 95% são ruído.</strong></div>
  <div>O <strong>On-Chain SetValues</strong> remove o ruído e te mostra onde focar.</div>
  <div>Acesso gratuito 24h: <strong>onchainsetvalues@gmail.com</strong></div>
  <div>Após 24h: R$55 via PIX ou 10 USDT (BEP20)</div>
</header>

<div id="login">
  <input type="email" id="email" placeholder="Seu e-mail autorizado" />
  <button onclick="enviarCodigo()">Enviar código</button><br><br>
  <input type="text" id="codigo" placeholder="Digite o código" />
  <button onclick="verificarCodigo()">Entrar</button>
  <p id="mensagem" style="color:red;"></p>
</div>

<div class="painel">
  <table id="painel" class="display nowrap"></table>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<script>
  const urlAPI = "https://script.google.com/macros/s/AKfycby6nK1df9XhD96xMLmJeWVRcQw5BRlPZ1R5LdiqArABNe_g5LLz-mc6QPpdAxZrqml3Sw/exec"; // Substitua aqui

  function enviarCodigo() {
    const email = document.getElementById("email").value.trim();
    if (!email) {
      document.getElementById("mensagem").textContent = "Informe seu e-mail.";
      return;
    }
    fetch(`${urlAPI}?acao=enviar&email=${encodeURIComponent(email)}`)
      .then(r => r.json())
      .then(res => {
        if (res.erro) {
          document.getElementById("mensagem").textContent = res.erro;
        } else {
          document.getElementById("mensagem").style.color = "green";
          document.getElementById("mensagem").textContent = res.status;
        }
      })
      .catch(() => document.getElementById("mensagem").textContent = "Erro ao enviar o código.");
  }

  function verificarCodigo() {
    const email = document.getElementById("email").value.trim();
    const codigo = document.getElementById("codigo").value.trim();
    if (!email || !codigo) {
      document.getElementById("mensagem").textContent = "Preencha e-mail e código.";
      return;
    }

    fetch(`${urlAPI}?acao=verificar&email=${encodeURIComponent(email)}&codigo=${codigo}`)
      .then(r => r.json())
      .then(res => {
        if (res.erro) {
          document.getElementById("mensagem").textContent = res.erro;
        } else {
          document.getElementById("login").style.display = "none";
          document.querySelector(".painel").style.display = "block";
          carregarTabela(res);
        }
      })
      .catch(() => document.getElementById("mensagem").textContent = "Erro ao verificar.");
  }

  function carregarTabela(dados) {
    if (!dados || dados.length === 0) {
      document.getElementById("painel").innerHTML = "<p style='color:red'>Nenhum dado retornado.</p>";
      return;
    }

    const colunas = Object.keys(dados[0]);
    const dadosFormatados = dados.map(item =>
      colunas.map(campo => campo.toLowerCase() === "link" ? `<a href="${item[campo]}" target="_blank">Ver</a>` : item[campo])
    );

    $('#painel').DataTable({
      data: dadosFormatados,
      columns: colunas.map(c => ({ title: c })),
      scrollX: true,
      paging: false,
      searching: false,
      info: false,
      createdRow: function(row, data) {
        const score = parseFloat(data[colunas.indexOf("Pontuação Balanceada")]);
        if (score >= 600) $(row).addClass('azul');
        else if (score >= 500) $(row).addClass('verde');
        else if (score >= 300) $(row).addClass('amarelo');
        else if (score >= 250) $(row).addClass('rosa');
      },
      language: { url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/pt-BR.json" }
    });
  }
</script>

</body>
</html>
