<script>
    const urlAPI = "https://script.google.com/macros/s/AKfycbxvWUfo_Fzlm6b2ZP20-aK5AEeF4b1phehQmvUBsWoja9aALWuAq8aiK0LYOQEb93MF/exec";

    function verificarEmail() {
      const email = document.getElementById("email").value.trim().toLowerCase();
      if (!email.includes("@")) {
        document.getElementById("erro").innerText = "Digite um e-mail vÃ¡lido.";
        return;
      }

      fetch(urlAPI + "?email=" + encodeURIComponent(email))
        .then(res => res.json())
        .then(dados => {
          if (dados.erro) {
            document.getElementById("erro").innerText = "Acesso negado.";
            return;
          }

          document.getElementById("login").style.display = "none";
          document.getElementById("tabela").style.display = "table";

          const colunas = Object.keys(dados[0]);
          const remover = ["Volume", "Market Cap"];
          const colunasFiltradas = colunas.filter(c => !remover.includes(c));
          const dadosFiltrados = dados.map(linha => {
            return colunasFiltradas.map(c => {
              if (c === "Link") return `<a href="${linha[c]}" target="_blank">ðŸ”—</a>`;
              return linha[c];
            });
          });

          const thead = '<thead><tr>' + colunasFiltradas.map(c => `<th>${c}</th>`).join('') + '</tr></thead>';
          document.getElementById("tabela").innerHTML = thead;

          $('#tabela').DataTable({
            data: dadosFiltrados,
            columns: colunasFiltradas.map(c => ({ title: c })),
            scrollY: '700px',
            scrollCollapse: true,
            paging: false,
            dom: 'Bfrtip',
            buttons: ['csv', 'pdf'],
            createdRow: function (row, data) {
              const score = parseFloat(data[10]);
              if (score >= 600) $(row).addClass('azul');
              else if (score >= 500) $(row).addClass('verde');
              else if (score >= 300) $(row).addClass('amarelo');
              else if (score >= 250) $(row).addClass('rosa');
            },
            language: {
              url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/pt-BR.json"
            }
          });
        })
        .catch(() => {
          document.getElementById("erro").innerText = "Erro ao carregar dados.";
        });
    }
  </script>
</body>
</html>
